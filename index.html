<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HotBird JSON Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <style>
        .json-editor {
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        .json-key {
            color: #881391;
        }
        .json-string {
            color: #c41a16;
        }
        .json-number {
            color: #1c00cf;
        }
        .json-boolean {
            color: #0d22aa;
        }
        .json-null {
            color: #808080;
        }
        .item-card {
            transition: all 0.2s ease;
        }
        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .dropdown-container {
            position: relative;
        }
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .dropdown-item {
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
        }
        .dropdown-item:hover {
            background-color: #f9fafb;
        }
        .dropdown-item:last-child {
            border-bottom: none;
        }
        .tag-filter {
            display: inline-block;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            padding: 0.25rem 0.5rem;
            background-color: #e5e7eb;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
        }
        .tag-filter.active {
            background-color: #D62616;
            color: white;
        }
        .file-tab {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            background-color: #f3f4f6;
            border-radius: 0.375rem;
            cursor: pointer;
        }
        .file-tab.active {
            background-color: #D62616;
            color: white;
        }
        .file-tab .close {
            margin-left: 0.5rem;
            opacity: 0.7;
        }
        .file-tab .close:hover {
            opacity: 1;
        }
        .tag-info {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        .combo-item {
            background-color: #f8f9fa;
            border-left: 4px solid #D62616;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">HotBird Menu Editor</h1>
            <p class="text-gray-600">Upload, edit, and manage your menu JSON files with this tool</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- File Upload Section -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Upload JSON Files</h2>
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center mb-4">
                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                    <p class="text-gray-600 mb-4">Drag & drop your JSON files here or click to browse</p>
                    <input type="file" id="json-file-input" accept=".json" multiple class="hidden">
                    <button id="upload-btn" class="bg-[#D62616] hover:bg-[#a01c10] text-white font-medium py-2 px-4 rounded">
                        Select JSON Files
                    </button>
                </div>
                
                <!-- File Tabs -->
                <div id="file-tabs" class="mb-4">
                    <!-- File tabs will be dynamically added here -->
                </div>
                
                <div id="file-info" class="hidden bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-medium text-gray-800 mb-2">Loaded Files:</h3>
                    <ul id="file-list" class="text-sm text-gray-600">
                        <!-- Files will be listed here -->
                    </ul>
                    <p class="mt-2"><span id="item-count">0</span> menu items loaded in current file</p>
                </div>
                
                <!-- JSON Text Editor Section -->
                <div class="mt-6">
                    <h3 class="text-lg font-semibold mb-2 text-gray-800">JSON Text Editor</h3>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Select File to Edit</label>
                            <select id="json-file-selector" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                <option value="">Select a file...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-1">JSON Content</label>
                            <textarea id="json-text-editor" rows="10" class="w-full px-3 py-2 border border-gray-300 rounded-md font-mono text-sm" placeholder="Paste JSON content here..."></textarea>
                        </div>
                        <div class="flex space-x-2">
                            <button id="update-json-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded">
                                Update from Text
                            </button>
                            <button id="copy-json-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded">
                                Copy JSON
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Actions Section -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">File Actions</h2>
                <div class="space-y-4">
                    <button id="download-btn" disabled class="w-full bg-[#D62616] hover:bg-[#a01c10] disabled:bg-[#D62616]/50 text-white font-medium py-3 px-4 rounded flex items-center justify-center">
                        <i class="fas fa-download mr-2"></i> Download Modified JSON
                    </button>
                    <button id="copy-file-btn" disabled class="w-full bg-purple-500 hover:bg-purple-600 disabled:bg-purple-300 text-white font-medium py-3 px-4 rounded flex items-center justify-center">
                        <i class="fas fa-copy mr-2"></i> Copy File As...
                    </button>
                    <button id="new-item-btn" disabled class="w-full bg-green-500 hover:bg-green-600 disabled:bg-green-300 text-white font-medium py-3 px-4 rounded flex items-center justify-center">
                        <i class="fas fa-plus-circle mr-2"></i> Add New Menu Item
                    </button>
                    <button id="reset-btn" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-medium py-3 px-4 rounded flex items-center justify-center">
                        <i class="fas fa-redo mr-2"></i> Reset Editor
                    </button>
                </div>
                
                <div class="mt-6">
                    <h3 class="font-medium text-gray-800 mb-2">JSON Structure Guide</h3>
                    <div class="bg-gray-50 p-4 rounded-lg text-sm">
                        <p class="text-gray-600 mb-2">Each menu item should have these properties:</p>
                        <ul class="list-disc pl-5 text-gray-600">
                            <li><span class="font-mono">name</span> (string)</li>
                            <li><span class="font-mono">description</span> (string)</li>
                            <li><span class="font-mono">image</span> (string, path to image)</li>
                            <li><span class="font-mono">price</span> (number, optional if options exist)</li>
                            <li><span class="font-mono">tags</span> (array of strings)</li>
                            <li><span class="font-mono">mealPriceModifier</span> (number)</li>
                            <li><span class="font-mono">showSlider</span> (boolean)</li>
                            <li><span class="font-mono">sauces</span> (boolean)</li>
                            <li><span class="font-mono">vegetables</span> (boolean)</li>
                            <li><span class="font-mono">showDrinksDropdown</span> (boolean)</li>
                            <li><span class="font-mono">options</span> (array of objects, optional)</li>
                            <li><span class="font-mono">comboItems</span> (array of objects, optional)</li>
                            <li><span class="font-mono">bs</span> (boolean, optional)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Items Editor Section -->
        <div id="editor-section" class="hidden mt-8">
            <h2 class="text-2xl font-semibold mb-6 text-gray-800">Menu Items Editor</h2>
            <div id="items-container" class="grid grid-cols-1 gap-6">
                <!-- Items will be dynamically added here -->
            </div>
        </div>

        <!-- New Item Modal -->
        <div id="new-item-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white rounded-lg shadow-xl w-11/12 md:w-3/4 lg:w-2/3 max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-800">Add New Menu Item</h3>
                        <button id="close-modal" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div id="new-item-form" class="space-y-4">
                        <!-- Form will be dynamically generated -->
                    </div>
                    <div class="flex justify-end mt-6 space-x-3">
                        <button id="cancel-new-item" class="px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-100">Cancel</button>
                        <button id="save-new-item" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">Save Item</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Copy File Modal -->
        <div id="copy-file-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-800">Copy File As</h3>
                        <button id="close-copy-modal" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">New File Name</label>
                            <input type="text" id="new-file-name" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="e.g., new-menu.json">
                        </div>
                    </div>
                    <div class="flex justify-end mt-6 space-x-3">
                        <button id="cancel-copy" class="px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-100">Cancel</button>
                        <button id="confirm-copy" class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600">Copy File</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentJsonData = null;
        let currentFileName = '';
        let allMenuItems = {}; // Store all items from all loaded files

        // Tag definitions with explanations
        const tagDefinitions = {
            "all": "Shows all menu items",
            "hotdeals": "Special promotional deals and offers",
            "hotbuckets": "Bucket meals with multiple pieces of chicken",
            "hotbirds": "Individual chicken items like burgers and sandwiches",
            "wings": "Chicken wings with various flavor options",
            "hottenders": "Chicken tenders and strips",
            "sauces": "Dips and sauces for chicken items",
            "drinks": "Beverages and drinks",
            "D": "Items that use the image position slider (for vertical adjustment)",
            "M": "Items that show the full image without cropping",
            "bs": "Best seller items - highlighted as popular choices"
        };

        // DOM elements
        const fileInput = document.getElementById('json-file-input');
        const uploadBtn = document.getElementById('upload-btn');
        const fileInfo = document.getElementById('file-info');
        const fileList = document.getElementById('file-list');
        const fileTabs = document.getElementById('file-tabs');
        const itemCount = document.getElementById('item-count');
        const downloadBtn = document.getElementById('download-btn');
        const copyFileBtn = document.getElementById('copy-file-btn');
        const newItemBtn = document.getElementById('new-item-btn');
        const resetBtn = document.getElementById('reset-btn');
        const editorSection = document.getElementById('editor-section');
        const itemsContainer = document.getElementById('items-container');
        const newItemModal = document.getElementById('new-item-modal');
        const closeModal = document.getElementById('close-modal');
        const cancelNewItem = document.getElementById('cancel-new-item');
        const saveNewItem = document.getElementById('save-new-item');
        const newItemForm = document.getElementById('new-item-form');
        const copyFileModal = document.getElementById('copy-file-modal');
        const closeCopyModal = document.getElementById('close-copy-modal');
        const cancelCopy = document.getElementById('cancel-copy');
        const confirmCopy = document.getElementById('confirm-copy');
        const newFileName = document.getElementById('new-file-name');
        const jsonFileSelector = document.getElementById('json-file-selector');
        const jsonTextEditor = document.getElementById('json-text-editor');
        const updateJsonBtn = document.getElementById('update-json-btn');
        const copyJsonBtn = document.getElementById('copy-json-btn');

        // Event listeners
        uploadBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileUpload);
        downloadBtn.addEventListener('click', downloadJson);
        copyFileBtn.addEventListener('click', showCopyFileModal);
        newItemBtn.addEventListener('click', showNewItemModal);
        resetBtn.addEventListener('click', resetEditor);
        closeModal.addEventListener('click', hideNewItemModal);
        cancelNewItem.addEventListener('click', hideNewItemModal);
        saveNewItem.addEventListener('click', saveNewItemToJson);
        closeCopyModal.addEventListener('click', hideCopyFileModal);
        cancelCopy.addEventListener('click', hideCopyFileModal);
        confirmCopy.addEventListener('click', copyFile);
        jsonFileSelector.addEventListener('change', updateJsonTextEditor);
        updateJsonBtn.addEventListener('click', updateJsonFromText);
        copyJsonBtn.addEventListener('click', copyJsonToClipboard);

        // Handle file upload
        function handleFileUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) {
                alert('Please select at least one JSON file');
                return;
            }

            let loadedFiles = 0;
            let totalFiles = files.length;
            
            files.forEach(file => {
                if (!file.name.endsWith('.json')) {
                    alert(`File "${file.name}" is not a valid JSON file`);
                    totalFiles--;
                    return;
                }

                // Check if file is already loaded
                if (allMenuItems[file.name]) {
                    if (!confirm(`File "${file.name}" is already loaded. Do you want to replace it?`)) {
                        totalFiles--;
                        return;
                    }
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const jsonData = JSON.parse(e.target.result);
                        allMenuItems[file.name] = jsonData;
                        
                        loadedFiles++;
                        
                        // If this is the first file, set it as current
                        if (Object.keys(allMenuItems).length === 1) {
                            currentFileName = file.name;
                            currentJsonData = jsonData;
                        }
                        
                        // If all files are loaded, update UI
                        if (loadedFiles === totalFiles) {
                            updateFileTabs();
                            updateFileList();
                            updateJsonFileSelector();
                            
                            if (currentFileName === file.name) {
                                updateItemCount();
                                fileInfo.classList.remove('hidden');
                                downloadBtn.disabled = false;
                                copyFileBtn.disabled = false;
                                newItemBtn.disabled = false;
                                editorSection.classList.remove('hidden');
                                renderItemsEditor();
                            }
                        }
                    } catch (error) {
                        alert(`Error parsing JSON in file "${file.name}": ${error.message}`);
                        totalFiles--;
                    }
                };
                reader.readAsText(file);
            });
            
            // Reset file input to allow selecting the same file again
            fileInput.value = '';
        }

        // Update file tabs
        function updateFileTabs() {
            fileTabs.innerHTML = '';
            
            Object.keys(allMenuItems).forEach(fileName => {
                const tab = document.createElement('div');
                tab.className = `file-tab ${fileName === currentFileName ? 'active' : ''}`;
                tab.innerHTML = `
                    <span>${fileName}</span>
                    <span class="close" data-file="${fileName}">&times;</span>
                `;
                
                tab.addEventListener('click', (e) => {
                    if (e.target.classList.contains('close')) {
                        e.stopPropagation();
                        removeFile(fileName);
                    } else {
                        switchToFile(fileName);
                    }
                });
                
                fileTabs.appendChild(tab);
            });
        }

        // Update file list
        function updateFileList() {
            fileList.innerHTML = '';
            
            Object.keys(allMenuItems).forEach(fileName => {
                const fileItem = document.createElement('li');
                fileItem.textContent = `${fileName} (${allMenuItems[fileName].items.length} items)`;
                fileList.appendChild(fileItem);
            });
        }

        // Update JSON file selector
        function updateJsonFileSelector() {
            jsonFileSelector.innerHTML = '<option value="">Select a file...</option>';
            
            Object.keys(allMenuItems).forEach(fileName => {
                const option = document.createElement('option');
                option.value = fileName;
                option.textContent = fileName;
                jsonFileSelector.appendChild(option);
            });
        }

        // Update item count
        function updateItemCount() {
            if (currentJsonData) {
                itemCount.textContent = currentJsonData.items.length;
            } else {
                itemCount.textContent = '0';
            }
        }

        // Switch to a different file
        function switchToFile(fileName) {
            currentFileName = fileName;
            currentJsonData = allMenuItems[fileName];
            
            updateFileTabs();
            updateItemCount();
            renderItemsEditor();
            updateJsonTextEditor();
        }

        // Remove a file
        function removeFile(fileName) {
            if (Object.keys(allMenuItems).length === 1) {
                alert('You cannot remove the last file');
                return;
            }
            
            delete allMenuItems[fileName];
            
            if (fileName === currentFileName) {
                // Switch to the first available file
                const firstFile = Object.keys(allMenuItems)[0];
                switchToFile(firstFile);
            } else {
                updateFileTabs();
                updateFileList();
                updateJsonFileSelector();
            }
        }

        // Update JSON text editor
        function updateJsonTextEditor() {
            if (currentJsonData) {
                jsonTextEditor.value = JSON.stringify(currentJsonData, null, 2);
            } else {
                jsonTextEditor.value = '';
            }
        }

        // Update JSON from text
        function updateJsonFromText() {
            const selectedFile = jsonFileSelector.value;
            if (!selectedFile) {
                alert('Please select a file to update');
                return;
            }
            
            try {
                const jsonData = JSON.parse(jsonTextEditor.value);
                allMenuItems[selectedFile] = jsonData;
                
                if (selectedFile === currentFileName) {
                    currentJsonData = jsonData;
                    updateItemCount();
                    renderItemsEditor();
                }
                
                alert('JSON updated successfully!');
            } catch (error) {
                alert(`Error parsing JSON: ${error.message}`);
            }
        }

        // Copy JSON to clipboard
        function copyJsonToClipboard() {
            if (!jsonTextEditor.value) {
                alert('No JSON content to copy');
                return;
            }
            
            jsonTextEditor.select();
            document.execCommand('copy');
            alert('JSON copied to clipboard!');
        }

        // Render the items editor
        function renderItemsEditor() {
            itemsContainer.innerHTML = '';
            
            if (!currentJsonData || !currentJsonData.items) {
                return;
            }
            
            currentJsonData.items.forEach((item, index) => {
                const itemCard = document.createElement('div');
                itemCard.className = 'item-card bg-white rounded-lg shadow p-6';
                
                itemCard.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-lg font-medium text-gray-800">${item.name}</h3>
                        <button class="delete-item text-red-500 hover:text-red-700" data-index="${index}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                            <input type="text" value="${escapeHtml(item.name)}" data-field="name" data-index="${index}" 
                                class="item-field w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Price</label>
                            <input type="number" step="0.01" value="${item.price || ''}" data-field="price" data-index="${index}" 
                                class="item-field w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea data-field="description" data-index="${index}" 
                                class="item-field w-full px-3 py-2 border border-gray-300 rounded-md">${escapeHtml(item.description)}</textarea>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Image Path</label>
                            <input type="text" value="${escapeHtml(item.image)}" data-field="image" data-index="${index}" 
                                class="item-field w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tags</label>
                            <div class="dropdown-container">
                                <input type="text" value="${Array.isArray(item.tags) ? item.tags.join(', ') : ''}" data-field="tags" data-index="${index}" 
                                    class="item-field w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Click to select tags">
                                <div class="dropdown-menu hidden" id="tags-dropdown-${index}">
                                    ${Object.keys(tagDefinitions).map(tag => `
                                        <div class="dropdown-item" data-tag="${tag}">
                                            <span class="font-medium">${tag}</span>
                                            <div class="tag-info">${tagDefinitions[tag]}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Meal Price Modifier</label>
                            <input type="number" step="0.01" value="${item.mealPriceModifier}" data-field="mealPriceModifier" data-index="${index}" 
                                class="item-field w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" ${item.showSlider ? 'checked' : ''} data-field="showSlider" data-index="${index}" 
                                class="item-field h-5 w-5 text-[#D62616] rounded">
                            <label class="ml-2 text-sm font-medium text-gray-700">Show Slider</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" ${item.sauces ? 'checked' : ''} data-field="sauces" data-index="${index}" 
                                class="item-field h-5 w-5 text-[#D62616] rounded">
                            <label class="ml-2 text-sm font-medium text-gray-700">Sauces</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" ${item.vegetables ? 'checked' : ''} data-field="vegetables" data-index="${index}" 
                                class="item-field h-5 w-5 text-[#D62616] rounded">
                            <label class="ml-2 text-sm font-medium text-gray-700">Vegetables</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" ${item.showDrinksDropdown ? 'checked' : ''} data-field="showDrinksDropdown" data-index="${index}" 
                                class="item-field h-5 w-5 text-[#D62616] rounded">
                            <label class="ml-2 text-sm font-medium text-gray-700">Show Drinks Dropdown</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" ${item.bs ? 'checked' : ''} data-field="bs" data-index="${index}" 
                                class="item-field h-5 w-5 text-[#D62616] rounded">
                            <label class="ml-2 text-sm font-medium text-gray-700">Best Seller (bs)</label>
                        </div>
                    </div>
                    ${item.options ? `
                    <div class="mt-4">
                        <h4 class="text-md font-medium text-gray-800 mb-2">Options</h4>
                        <div id="options-${index}" class="space-y-2">
                            ${item.options.map((option, optIndex) => `
                                <div class="flex items-center space-x-2">
                                    <input type="text" placeholder="Option name" value="${escapeHtml(option.name)}" 
                                        data-option-field="name" data-index="${index}" data-option-index="${optIndex}" 
                                        class="option-field w-1/2 px-3 py-1 border border-gray-300 rounded-md">
                                    <input type="number" step="0.01" placeholder="Price" value="${option.price}" 
                                        data-option-field="price" data-index="${index}" data-option-index="${optIndex}" 
                                        class="option-field w-1/3 px-3 py-1 border border-gray-300 rounded-md">
                                    <button class="delete-option text-red-500 hover:text-red-700" data-index="${index}" data-option-index="${optIndex}">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                        <button class="add-option mt-2 text-sm text-[#D62616] hover:text-[#a01c10]" data-index="${index}">
                            <i class="fas fa-plus mr-1"></i> Add Option
                        </button>
                    </div>
                    ` : ''}
                    ${item.comboItems ? `
                    <div class="mt-4">
                        <h4 class="text-md font-medium text-gray-800 mb-2">Combo Items</h4>
                        <div id="combo-items-${index}" class="space-y-2">
                            ${item.comboItems.map((comboItem, comboIndex) => `
                                <div class="combo-item">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <input type="text" placeholder="Item name" value="${escapeHtml(comboItem.name)}" 
                                            data-combo-field="name" data-index="${index}" data-combo-index="${comboIndex}" 
                                            class="combo-field w-1/2 px-3 py-1 border border-gray-300 rounded-md">
                                        <input type="number" placeholder="Quantity" value="${comboItem.quantity}" 
                                            data-combo-field="quantity" data-index="${index}" data-combo-index="${comboIndex}" 
                                            class="combo-field w-1/4 px-3 py-1 border border-gray-300 rounded-md">
                                        <input type="text" placeholder="Option" value="${comboItem.option || ''}" 
                                            data-combo-field="option" data-index="${index}" data-combo-index="${comboIndex}" 
                                            class="combo-field w-1/4 px-3 py-1 border border-gray-300 rounded-md">
                                        <button class="delete-combo text-red-500 hover:text-red-700" data-index="${index}" data-combo-index="${comboIndex}">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <button class="add-combo mt-2 text-sm text-[#D62616] hover:text-[#a01c10]" data-index="${index}">
                            <i class="fas fa-plus mr-1"></i> Add Combo Item
                        </button>
                    </div>
                    ` : ''}
                `;
                itemsContainer.appendChild(itemCard);
            });

            // Add event listeners to all dynamic fields
            document.querySelectorAll('.item-field').forEach(field => {
                field.addEventListener('change', updateItemField);
                field.addEventListener('input', updateItemField);
                
                // Add dropdown functionality for tags
                if (field.dataset.field === 'tags') {
                    const dropdown = document.getElementById(`tags-dropdown-${field.dataset.index}`);
                    
                    field.addEventListener('focus', () => {
                        dropdown.classList.remove('hidden');
                    });
                    
                    field.addEventListener('blur', () => {
                        setTimeout(() => {
                            dropdown.classList.add('hidden');
                        }, 200);
                    });
                    
                    // Add click handlers for dropdown items
                    dropdown.querySelectorAll('.dropdown-item').forEach(item => {
                        item.addEventListener('click', () => {
                            const tag = item.dataset.tag;
                            const currentValue = field.value;
                            const currentTags = currentValue ? currentValue.split(',').map(t => t.trim()) : [];
                            
                            if (!currentTags.includes(tag)) {
                                currentTags.push(tag);
                                field.value = currentTags.join(', ');
                                updateItemField({target: field});
                            }
                            
                            dropdown.classList.add('hidden');
                        });
                    });
                }
            });

            document.querySelectorAll('.option-field').forEach(field => {
                field.addEventListener('change', updateOptionField);
                field.addEventListener('input', updateOptionField);
            });

            document.querySelectorAll('.combo-field').forEach(field => {
                field.addEventListener('change', updateComboField);
                field.addEventListener('input', updateComboField);
            });

            document.querySelectorAll('.delete-item').forEach(button => {
                button.addEventListener('click', deleteItem);
            });

            document.querySelectorAll('.delete-option').forEach(button => {
                button.addEventListener('click', deleteOption);
            });

            document.querySelectorAll('.delete-combo').forEach(button => {
                button.addEventListener('click', deleteCombo);
            });

            document.querySelectorAll('.add-option').forEach(button => {
                button.addEventListener('click', addOption);
            });

            document.querySelectorAll('.add-combo').forEach(button => {
                button.addEventListener('click', addCombo);
            });
        }

        // Update item field
        function updateItemField(event) {
            const index = parseInt(event.target.dataset.index);
            const field = event.target.dataset.field;
            let value = event.target.value;
            
            if (field === 'tags') {
                value = value.split(',').map(tag => tag.trim()).filter(tag => tag !== '');
            } else if (field === 'price' || field === 'mealPriceModifier') {
                value = parseFloat(value) || 0;
            } else if (field === 'showSlider' || field === 'sauces' || field === 'vegetables' || field === 'showDrinksDropdown' || field === 'bs') {
                value = event.target.checked;
            }
            
            currentJsonData.items[index][field] = value;
            updateJsonTextEditor();
        }

        // Update option field
        function updateOptionField(event) {
            const index = parseInt(event.target.dataset.index);
            const optionIndex = parseInt(event.target.dataset.optionIndex);
            const field = event.target.dataset.optionField;
            let value = event.target.value;
            
            if (field === 'price') {
                value = parseFloat(value) || 0;
            }
            
            // Initialize options array if it doesn't exist
            if (!currentJsonData.items[index].options) {
                currentJsonData.items[index].options = [];
            }
            
            // Initialize option object if it doesn't exist
            if (!currentJsonData.items[index].options[optionIndex]) {
                currentJsonData.items[index].options[optionIndex] = {};
            }
            
            currentJsonData.items[index].options[optionIndex][field] = value;
            updateJsonTextEditor();
        }

        // Update combo field
        function updateComboField(event) {
            const index = parseInt(event.target.dataset.index);
            const comboIndex = parseInt(event.target.dataset.comboIndex);
            const field = event.target.dataset.comboField;
            let value = event.target.value;
            
            if (field === 'quantity') {
                value = parseInt(value) || 1;
            }
            
            // Initialize comboItems array if it doesn't exist
            if (!currentJsonData.items[index].comboItems) {
                currentJsonData.items[index].comboItems = [];
            }
            
            // Initialize comboItem object if it doesn't exist
            if (!currentJsonData.items[index].comboItems[comboIndex]) {
                currentJsonData.items[index].comboItems[comboIndex] = {};
            }
            
            currentJsonData.items[index].comboItems[comboIndex][field] = value;
            updateJsonTextEditor();
        }

        // Delete item
        function deleteItem(event) {
            const index = parseInt(event.currentTarget.dataset.index);
            currentJsonData.items.splice(index, 1);
            updateItemCount();
            renderItemsEditor();
            updateJsonTextEditor();
        }

        // Delete option
        function deleteOption(event) {
            const index = parseInt(event.currentTarget.dataset.index);
            const optionIndex = parseInt(event.currentTarget.dataset.optionIndex);
            
            if (currentJsonData.items[index].options) {
                currentJsonData.items[index].options.splice(optionIndex, 1);
                
                // Remove options array if empty
                if (currentJsonData.items[index].options.length === 0) {
                    delete currentJsonData.items[index].options;
                }
                
                renderItemsEditor();
                updateJsonTextEditor();
            }
        }

        // Delete combo
        function deleteCombo(event) {
            const index = parseInt(event.currentTarget.dataset.index);
            const comboIndex = parseInt(event.currentTarget.dataset.comboIndex);
            
            if (currentJsonData.items[index].comboItems) {
                currentJsonData.items[index].comboItems.splice(comboIndex, 1);
                
                // Remove comboItems array if empty
                if (currentJsonData.items[index].comboItems.length === 0) {
                    delete currentJsonData.items[index].comboItems;
                }
                
                renderItemsEditor();
                updateJsonTextEditor();
            }
        }

        // Add option
        function addOption(event) {
            const index = parseInt(event.currentTarget.dataset.index);
            
            // Initialize options array if it doesn't exist
            if (!currentJsonData.items[index].options) {
                currentJsonData.items[index].options = [];
            }
            
            currentJsonData.items[index].options.push({
                name: '',
                price: 0
            });
            
            renderItemsEditor();
            updateJsonTextEditor();
        }

        // Add combo
        function addCombo(event) {
            const index = parseInt(event.currentTarget.dataset.index);
            
            // Initialize comboItems array if it doesn't exist
            if (!currentJsonData.items[index].comboItems) {
                currentJsonData.items[index].comboItems = [];
            }
            
            currentJsonData.items[index].comboItems.push({
                name: '',
                quantity: 1,
                option: ''
            });
            
            renderItemsEditor();
            updateJsonTextEditor();
        }

        // Show new item modal
        function showNewItemModal() {
            newItemForm.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
                        <input type="text" id="new-item-name" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Price</label>
                        <input type="number" step="0.01" id="new-item-price" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description *</label>
                        <textarea id="new-item-description" class="w-full px-3 py-2 border border-gray-300 rounded-md" required></textarea>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Image Path</label>
                        <input type="text" id="new-item-image" class="w-full px-3 py-2 border border-gray-300 rounded-md" value="images/">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tags *</label>
                        <div class="dropdown-container">
                            <input type="text" id="new-item-tags" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Click to select tags" required>
                            <div class="dropdown-menu hidden" id="new-tags-dropdown">
                                ${Object.keys(tagDefinitions).map(tag => `
                                    <div class="dropdown-item" data-tag="${tag}">
                                        <span class="font-medium">${tag}</span>
                                        <div class="tag-info">${tagDefinitions[tag]}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Meal Price Modifier</label>
                        <input type="number" step="0.01" id="new-item-mealPriceModifier" class="w-full px-3 py-2 border border-gray-300 rounded-md" value="0">
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="new-item-showSlider" class="h-5 w-5 text-[#D62616] rounded">
                        <label class="ml-2 text-sm font-medium text-gray-700">Show Slider</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="new-item-sauces" class="h-5 w-5 text-[#D62616] rounded">
                        <label class="ml-2 text-sm font-medium text-gray-700">Sauces</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="new-item-vegetables" class="h-5 w-5 text-[#D62616] rounded">
                        <label class="ml-2 text-sm font-medium text-gray-700">Vegetables</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="new-item-showDrinksDropdown" class="h-5 w-5 text-[#D62616] rounded">
                        <label class="ml-2 text-sm font-medium text-gray-700">Show Drinks Dropdown</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="new-item-bs" class="h-5 w-5 text-[#D62616] rounded">
                        <label class="ml-2 text-sm font-medium text-gray-700">Best Seller (bs)</label>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Options</label>
                        <div id="new-item-options" class="space-y-2 mb-2">
                            <!-- Options will be added here -->
                        </div>
                        <button type="button" id="add-new-option" class="text-sm text-[#D62616] hover:text-[#a01c10]">
                            <i class="fas fa-plus mr-1"></i> Add Option
                        </button>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Combo Items</label>
                        <div id="new-item-combo" class="space-y-2 mb-2">
                            <!-- Combo items will be added here -->
                        </div>
                        <button type="button" id="add-new-combo" class="text-sm text-[#D62616] hover:text-[#a01c10]">
                            <i class="fas fa-plus mr-1"></i> Add Combo Item
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listener for adding options in the new item form
            document.getElementById('add-new-option').addEventListener('click', addNewOption);
            document.getElementById('add-new-combo').addEventListener('click', addNewCombo);
            
            // Add dropdown functionality for tags in new item form
            const tagsInput = document.getElementById('new-item-tags');
            const tagsDropdown = document.getElementById('new-tags-dropdown');
            
            tagsInput.addEventListener('focus', () => {
                tagsDropdown.classList.remove('hidden');
            });
            
            tagsInput.addEventListener('blur', () => {
                setTimeout(() => {
                    tagsDropdown.classList.add('hidden');
                }, 200);
            });
            
            // Add click handlers for dropdown items
            tagsDropdown.querySelectorAll('.dropdown-item').forEach(item => {
                item.addEventListener('click', () => {
                    const tag = item.dataset.tag;
                    const currentValue = tagsInput.value;
                    const currentTags = currentValue ? currentValue.split(',').map(t => t.trim()) : [];
                    
                    if (!currentTags.includes(tag)) {
                        currentTags.push(tag);
                        tagsInput.value = currentTags.join(', ');
                    }
                    
                    tagsDropdown.classList.add('hidden');
                });
            });
            
            newItemModal.classList.remove('hidden');
        }

        // Add option to new item form
        function addNewOption() {
            const optionsContainer = document.getElementById('new-item-options');
            const optionIndex = optionsContainer.children.length;
            
            const optionDiv = document.createElement('div');
            optionDiv.className = 'flex items-center space-x-2';
            optionDiv.innerHTML = `
                <input type="text" placeholder="Option name" 
                    class="new-option-name w-1/2 px-3 py-1 border border-gray-300 rounded-md">
                <input type="number" step="0.01" placeholder="Price" 
                    class="new-option-price w-1/3 px-3 py-1 border border-gray-300 rounded-md">
                <button class="remove-new-option text-red-500 hover:text-red-700">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            optionsContainer.appendChild(optionDiv);
            
            // Add event listener to remove button
            optionDiv.querySelector('.remove-new-option').addEventListener('click', function() {
                optionsContainer.removeChild(optionDiv);
            });
        }

        // Add combo to new item form
        function addNewCombo() {
            const comboContainer = document.getElementById('new-item-combo');
            const comboIndex = comboContainer.children.length;
            
            const comboDiv = document.createElement('div');
            comboDiv.className = 'combo-item';
            comboDiv.innerHTML = `
                <div class="flex items-center space-x-2">
                    <input type="text" placeholder="Item name" 
                        class="new-combo-name w-1/2 px-3 py-1 border border-gray-300 rounded-md">
                    <input type="number" placeholder="Quantity" 
                        class="new-combo-quantity w-1/4 px-3 py-1 border border-gray-300 rounded-md" value="1">
                    <input type="text" placeholder="Option" 
                        class="new-combo-option w-1/4 px-3 py-1 border border-gray-300 rounded-md">
                    <button class="remove-new-combo text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            comboContainer.appendChild(comboDiv);
            
            // Add event listener to remove button
            comboDiv.querySelector('.remove-new-combo').addEventListener('click', function() {
                comboContainer.removeChild(comboDiv);
            });
        }

        // Hide new item modal
        function hideNewItemModal() {
            newItemModal.classList.add('hidden');
        }

        // Save new item to JSON
        function saveNewItemToJson() {
            const name = document.getElementById('new-item-name').value;
            const description = document.getElementById('new-item-description').value;
            const tags = document.getElementById('new-item-tags').value;
            
            if (!name || !description || !tags) {
                alert('Please fill in all required fields (name, description, tags)');
                return;
            }
            
            const newItem = {
                name: name,
                description: description,
                image: document.getElementById('new-item-image').value || 'images/',
                tags: tags.split(',').map(tag => tag.trim()).filter(tag => tag !== ''),
                mealPriceModifier: parseFloat(document.getElementById('new-item-mealPriceModifier').value) || 0,
                showSlider: document.getElementById('new-item-showSlider').checked,
                sauces: document.getElementById('new-item-sauces').checked,
                vegetables: document.getElementById('new-item-vegetables').checked,
                showDrinksDropdown: document.getElementById('new-item-showDrinksDropdown').checked,
                bs: document.getElementById('new-item-bs').checked
            };
            
            const price = document.getElementById('new-item-price').value;
            if (price) {
                newItem.price = parseFloat(price);
            }
            
            // Process options
            const optionElements = document.querySelectorAll('#new-item-options > div');
            if (optionElements.length > 0) {
                newItem.options = [];
                
                optionElements.forEach(optionEl => {
                    const optionName = optionEl.querySelector('.new-option-name').value;
                    const optionPrice = optionEl.querySelector('.new-option-price').value;
                    
                    if (optionName) {
                        newItem.options.push({
                            name: optionName,
                            price: parseFloat(optionPrice) || 0
                        });
                    }
                });
                
                // Remove options if empty
                if (newItem.options.length === 0) {
                    delete newItem.options;
                }
            }
            
            // Process combo items
            const comboElements = document.querySelectorAll('#new-item-combo > div');
            if (comboElements.length > 0) {
                newItem.comboItems = [];
                
                comboElements.forEach(comboEl => {
                    const comboName = comboEl.querySelector('.new-combo-name').value;
                    const comboQuantity = comboEl.querySelector('.new-combo-quantity').value;
                    const comboOption = comboEl.querySelector('.new-combo-option').value;
                    
                    if (comboName) {
                        newItem.comboItems.push({
                            name: comboName,
                            quantity: parseInt(comboQuantity) || 1,
                            option: comboOption || ''
                        });
                    }
                });
                
                // Remove comboItems if empty
                if (newItem.comboItems.length === 0) {
                    delete newItem.comboItems;
                }
            }
            
            currentJsonData.items.push(newItem);
            updateItemCount();
            renderItemsEditor();
            updateJsonTextEditor();
            hideNewItemModal();
        }

        // Show copy file modal
        function showCopyFileModal() {
            newFileName.value = currentFileName.replace('.json', '-copy.json');
            copyFileModal.classList.remove('hidden');
        }

        // Hide copy file modal
        function hideCopyFileModal() {
            copyFileModal.classList.add('hidden');
        }

        // Copy file with new name
        function copyFile() {
            const fileName = newFileName.value;
            if (!fileName) {
                alert('Please enter a file name');
                return;
            }
            
            if (!fileName.endsWith('.json')) {
                alert('File name must end with .json');
                return;
            }
            
            currentFileName = fileName;
            downloadJson();
            hideCopyFileModal();
        }

        // Download JSON
        function downloadJson() {
            if (!currentJsonData) return;
            
            const dataStr = JSON.stringify(currentJsonData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = currentFileName;
            link.click();
        }

        // Reset editor
        function resetEditor() {
            currentJsonData = null;
            currentFileName = '';
            allMenuItems = {};
            fileInput.value = '';
            fileInfo.classList.add('hidden');
            downloadBtn.disabled = true;
            copyFileBtn.disabled = true;
            newItemBtn.disabled = true;
            editorSection.classList.add('hidden');
            itemsContainer.innerHTML = '';
            fileTabs.innerHTML = '';
            jsonFileSelector.innerHTML = '<option value="">Select a file...</option>';
            jsonTextEditor.value = '';
        }

        // Utility function to escape HTML
        function escapeHtml(unsafe) {
            if (unsafe === null || unsafe === undefined) return '';
            return unsafe.toString()
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>
